<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç­¾åå·¥å…·æµ‹è¯•</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    h1 {
      color: #667eea;
      text-align: center;
      margin-bottom: 30px;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border-left: 4px solid #667eea;
    }
    .test-section h3 {
      color: #333;
      margin-top: 0;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 14px;
      line-height: 1.5;
    }
    .success {
      color: #28a745;
      font-weight: bold;
    }
    .error {
      color: #dc3545;
      font-weight: bold;
    }
    .info {
      background: #e7f3ff;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Tokenç­¾åå·¥å…·æµ‹è¯•</h1>
    
    <div class="info">
      <strong>ğŸ“ è¯´æ˜ï¼š</strong> æ­¤é¡µé¢ç”¨äºæµ‹è¯•å‰ç«¯ç­¾åå·¥å…·æ˜¯å¦æ­£ç¡®å®ç°ã€‚ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹ç­¾åç»“æœã€‚
    </div>

    <div class="test-section">
      <h3>æµ‹è¯• 1ï¼šåŸºç¡€ç­¾åæµ‹è¯•</h3>
      <p>æµ‹è¯•ç®€å•å‚æ•°çš„ç­¾åç”Ÿæˆ</p>
      <button onclick="test1()">è¿è¡Œæµ‹è¯• 1</button>
      <pre id="result1">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
      <h3>æµ‹è¯• 2ï¼šå®Œæ•´å‚æ•°ç­¾åæµ‹è¯•ï¼ˆæ­»äº¡æ¨¡æ‹Ÿå™¨ï¼‰</h3>
      <p>æµ‹è¯•åŒ…å«æ‰€æœ‰å­—æ®µçš„æ’è¡Œæ¦œæ•°æ®ç­¾å</p>
      <button onclick="test2()">è¿è¡Œæµ‹è¯• 2</button>
      <pre id="result2">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
      <h3>æµ‹è¯• 3ï¼šä¸­æ–‡å‚æ•°æµ‹è¯•</h3>
      <p>æµ‹è¯•ä¸­æ–‡ç”¨æˆ·åçš„UTF-8ç¼–ç å’Œç­¾å</p>
      <button onclick="test3()">è¿è¡Œæµ‹è¯• 3</button>
      <pre id="result3">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
      <h3>æµ‹è¯• 4ï¼šå‚æ•°æ’åºéªŒè¯</h3>
      <p>éªŒè¯å‚æ•°æŒ‰å­—æ¯æ’åºåçš„ç­¾åä¸€è‡´æ€§</p>
      <button onclick="test4()">è¿è¡Œæµ‹è¯• 4</button>
      <pre id="result4">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
      <h3>æµ‹è¯• 5ï¼šæ—¶é—´æˆ³å”¯ä¸€æ€§æµ‹è¯•</h3>
      <p>éªŒè¯æ¯æ¬¡ç”Ÿæˆçš„timestampå’Œtokenéƒ½ä¸åŒ</p>
      <button onclick="test5()">è¿è¡Œæµ‹è¯• 5</button>
      <pre id="result5">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</pre>
    </div>
  </div>

  <script type="module">
    // ç®€åŒ–çš„å†…è”MD5å®ç°ï¼ˆç”¨äºæµ‹è¯•å¯¹æ¯”ï¼‰
    function simpleMD5(str) {
      // è¿™é‡Œä½¿ç”¨ä½ çš„æ··æ·†MD5å®ç°
      // ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬æš‚æ—¶è¾“å‡ºåŸå§‹å­—ç¬¦ä¸²çš„hashæ¨¡æ‹Ÿ
      return 'é¢„æœŸé€šè¿‡å®é™…MD5ç”Ÿæˆ';
    }

    // æ¨¡æ‹ŸSignUtilï¼ˆå®é™…åº”è¯¥ä»sign.jså¯¼å…¥ï¼‰
    window.testSignUtil = {
      sign: function(params) {
        const timestamp = Date.now().toString();
        const allParams = { ...params, timestamp };
        
        // æ·»åŠ salt
        const paramsWithSalt = { ...allParams, salt: 'salt' };
        
        // æ’åºå¹¶æ‹¼æ¥
        const sortedKeys = Object.keys(paramsWithSalt).sort();
        const signStr = sortedKeys.map(key => `${key}=${paramsWithSalt[key]}`).join('&');
        
        // è®¡ç®—MD5ï¼ˆè¿™é‡Œéœ€è¦å®é™…çš„MD5å‡½æ•°ï¼‰
        const token = 'md5(' + signStr + ')';
        
        return {
          ...allParams,
          token,
          __debug: {
            signString: signStr,
            sortedKeys
          }
        };
      }
    };

    // æµ‹è¯•å‡½æ•°
    window.test1 = function() {
      const result = window.testSignUtil.sign({
        userName: 'æµ‹è¯•ç”¨æˆ·',
        probability: '1e-9'
      });
      
      document.getElementById('result1').innerHTML = 
        'âœ… ç­¾åæˆåŠŸï¼\n\n' +
        'åŸå§‹å‚æ•°:\n' +
        JSON.stringify({ userName: 'æµ‹è¯•ç”¨æˆ·', probability: '1e-9' }, null, 2) + '\n\n' +
        'ç­¾åç»“æœ:\n' +
        JSON.stringify({
          userName: result.userName,
          probability: result.probability,
          timestamp: result.timestamp,
          token: result.token
        }, null, 2) + '\n\n' +
        'ç­¾åå­—ç¬¦ä¸²:\n' +
        result.__debug.signString + '\n\n' +
        'å‚æ•°æ’åº:\n' +
        result.__debug.sortedKeys.join(', ');
    };

    window.test2 = function() {
      const result = window.testSignUtil.sign({
        userName: 'å°æ˜',
        probability: '1e-9',
        probabilityLabel: 'åäº¿åˆ†ä¹‹ä¸€',
        survivalYears: '1000',
        survivalDays: '365000',
        earnedMoney: '10.00äº¿å…ƒ',
        earnedMoneyValue: '1000000000'
      });
      
      document.getElementById('result2').innerHTML = 
        'âœ… ç­¾åæˆåŠŸï¼\n\n' +
        'ç­¾åç»“æœ:\n' +
        JSON.stringify({
          userName: result.userName,
          timestamp: result.timestamp,
          token: result.token
        }, null, 2) + '\n\n' +
        'ç­¾åå­—ç¬¦ä¸²:\n' +
        result.__debug.signString;
    };

    window.test3 = function() {
      const testCases = [
        { userName: 'ææ˜', desc: 'ä¸­æ–‡å§“å' },
        { userName: 'å¼ ä¸‰ğŸ‰', desc: 'ä¸­æ–‡+Emoji' },
        { userName: 'Testæµ‹è¯•', desc: 'è‹±æ–‡+ä¸­æ–‡' }
      ];
      
      let output = '';
      testCases.forEach((testCase, index) => {
        const result = window.testSignUtil.sign({
          userName: testCase.userName,
          probability: '1e-9'
        });
        
        output += `æµ‹è¯• ${index + 1}ï¼š${testCase.desc}\n`;
        output += `  ç”¨æˆ·åï¼š${result.userName}\n`;
        output += `  Tokenï¼š${result.token}\n`;
        output += `  ç­¾åå­—ç¬¦ä¸²ï¼š${result.__debug.signString}\n\n`;
      });
      
      document.getElementById('result3').innerHTML = 'âœ… ä¸­æ–‡å‚æ•°æµ‹è¯•å®Œæˆï¼\n\n' + output;
    };

    window.test4 = function() {
      // æµ‹è¯•ä¸åŒé¡ºåºçš„å‚æ•°ï¼Œç­¾ååº”è¯¥ä¸€è‡´
      const result1 = window.testSignUtil.sign({
        userName: 'æµ‹è¯•',
        probability: '1e-9',
        survivalYears: '100'
      });
      
      const result2 = window.testSignUtil.sign({
        survivalYears: '100',
        userName: 'æµ‹è¯•',
        probability: '1e-9'
      });
      
      const match = result1.__debug.signString === result2.__debug.signString;
      
      document.getElementById('result4').innerHTML = 
        (match ? 'âœ… å‚æ•°æ’åºéªŒè¯é€šè¿‡ï¼' : 'âŒ å‚æ•°æ’åºéªŒè¯å¤±è´¥ï¼') + '\n\n' +
        'æµ‹è¯•1ç­¾åå­—ç¬¦ä¸²:\n' + result1.__debug.signString + '\n\n' +
        'æµ‹è¯•2ç­¾åå­—ç¬¦ä¸²:\n' + result2.__debug.signString + '\n\n' +
        'ç»“æœï¼š' + (match ? 'ä¸¤æ¬¡ç­¾åå­—ç¬¦ä¸²ä¸€è‡´' : 'ä¸¤æ¬¡ç­¾åå­—ç¬¦ä¸²ä¸ä¸€è‡´');
    };

    window.test5 = function() {
      const results = [];
      for (let i = 0; i < 3; i++) {
        const result = window.testSignUtil.sign({
          userName: 'æµ‹è¯•',
          probability: '1e-9'
        });
        results.push({
          timestamp: result.timestamp,
          token: result.token
        });
        // ç­‰å¾…1msç¡®ä¿timestampä¸åŒ
        const start = Date.now();
        while (Date.now() - start < 2) {}
      }
      
      const allDifferent = 
        results[0].timestamp !== results[1].timestamp &&
        results[1].timestamp !== results[2].timestamp;
      
      document.getElementById('result5').innerHTML = 
        (allDifferent ? 'âœ… æ—¶é—´æˆ³å”¯ä¸€æ€§éªŒè¯é€šè¿‡ï¼' : 'âŒ æ—¶é—´æˆ³å”¯ä¸€æ€§éªŒè¯å¤±è´¥ï¼') + '\n\n' +
        '3æ¬¡ç­¾åç»“æœ:\n' +
        JSON.stringify(results, null, 2) + '\n\n' +
        'ç»“è®ºï¼šæ¯æ¬¡ç”Ÿæˆçš„timestamp' + (allDifferent ? 'éƒ½ä¸åŒ' : 'å­˜åœ¨é‡å¤');
    };
  </script>

  <div class="container" style="margin-top: 30px;">
    <h2 style="color: #667eea;">ğŸ“š å¦‚ä½•ä½¿ç”¨å®é™…ç­¾åå·¥å…·æµ‹è¯•</h2>
    <div class="info">
      <p><strong>1. åœ¨Vueé¡¹ç›®ä¸­æµ‹è¯•ï¼š</strong></p>
      <pre style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; overflow-x: auto;">
// åœ¨ä»»æ„Vueç»„ä»¶çš„mounted()ä¸­æµ‹è¯•
import SignUtil from '@/utils/sign.js';

mounted() {
  const result = SignUtil.sign({
    userName: 'æµ‹è¯•ç”¨æˆ·',
    probability: '1e-9'
  });
  console.log('ç­¾åç»“æœ:', result);
}</pre>

      <p><strong>2. åœ¨æµè§ˆå™¨Consoleä¸­æµ‹è¯•ï¼ˆéœ€è¦å…ˆè¿è¡Œé¡¹ç›®ï¼‰ï¼š</strong></p>
      <pre style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; overflow-x: auto;">
// æ‰“å¼€ http://localhost:8080
// æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·
// åœ¨Consoleä¸­è¾“å…¥ï¼š

// æ³¨æ„ï¼šSignUtilå·²ç»å†…è”åœ¨rankingService.jsä¸­
// å¯ä»¥é€šè¿‡å®é™…APIè°ƒç”¨æŸ¥çœ‹ç­¾åæ•ˆæœ
// æ‰“å¼€Networkæ ‡ç­¾ï¼ŒæŸ¥çœ‹è¯·æ±‚URLä¸­çš„tokenå‚æ•°</pre>

      <p><strong>3. éªŒè¯ç­¾åæ­£ç¡®æ€§ï¼š</strong></p>
      <pre style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; overflow-x: auto;">
// ç­¾åå­—ç¬¦ä¸²ç¤ºä¾‹ï¼š
probability=1e-9&salt=salt&timestamp=1728393000000&userName=æµ‹è¯•ç”¨æˆ·

// å¯¹åº”çš„MD5å€¼å¯é€šè¿‡åœ¨çº¿å·¥å…·éªŒè¯ï¼š
// https://www.md5hashgenerator.com/
// æˆ–ä½¿ç”¨Node.jsï¼š
const crypto = require('crypto');
const hash = crypto.createHash('md5').update('ç­¾åå­—ç¬¦ä¸²').digest('hex');
console.log(hash);</pre>
    </div>
  </div>
</body>
</html>

